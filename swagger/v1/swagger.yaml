---
openapi: 3.0.1
info:
  title: Otter Drift API V1
  version: v1
  description: API documentation for Otter Drift game backend
paths:
  "/api/v1/leaderboard":
    get:
      summary: Get Leaderboard
      tags:
      - Leaderboards
      description: Retrieves the global leaderboard with top scores, ranked by score
        (highest first)
      parameters:
      - name: limit
        in: query
        required: false
        description: 'Number of entries to return (default: 100, max: 500)'
        schema:
          type: integer
      responses:
        '200':
          description: successful - empty leaderboard
          content:
            application/json:
              schema:
                type: object
                properties:
                  leaderboard:
                    type: array
                    description: Ranked list of high scores
                    items:
                      type: object
                      properties:
                        rank:
                          type: integer
                          description: Position in leaderboard (1-based)
                        score:
                          type: integer
                          description: Final score achieved
                        player_name:
                          type: string
                          description: Display name of the player
                        achieved_at:
                          type: string
                          format: date-time
                          description: When the score was achieved
                        is_guest:
                          type: boolean
                          description: Whether this was a guest session
                        player:
                          type: object
                          description: Player details (only present for authenticated
                            players)
                          properties:
                            username:
                              type: string
                              description: Player username
                            avatar_url:
                              type: string
                              nullable: true
                              description: Player avatar URL
                      required:
                      - rank
                      - score
                      - player_name
                      - achieved_at
                      - is_guest
                  total_entries:
                    type: integer
                    description: Number of entries returned
                  limit:
                    type: integer
                    description: Applied limit for this request
                required:
                - leaderboard
                - total_entries
                - limit
  "/api/v1/players/{username}/achievements":
    parameters:
    - name: username
      in: path
      description: Player username
      required: true
      schema:
        type: string
    get:
      summary: List Player Achievements
      tags:
      - Player Achievements
      description: Retrieves all achievements earned by a player, ordered by most
        recently collected
      responses:
        '200':
          description: successful - no achievements
          content:
            application/json:
              schema:
                type: object
                properties:
                  username:
                    type: string
                    description: Player username
                  total_achievements:
                    type: integer
                    description: Total number of achievements earned
                  achievements:
                    type: array
                    description: List of achievements ordered by collection date (most
                      recent first)
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          description: Achievement name
                        description:
                          type: string
                          description: Achievement description
                        achievement_type:
                          type: string
                          description: Unique achievement type identifier
                        points:
                          type: integer
                          description: Points awarded for this achievement
                        badge_url:
                          type: string
                          description: Badge URL if available, otherwise an emoji
                            fallback
                        collected_at:
                          type: string
                          format: date-time
                          description: When the achievement was earned
                      required:
                      - name
                      - description
                      - achievement_type
                      - points
                      - badge_url
                      - collected_at
                required:
                - username
                - total_achievements
                - achievements
        '404':
          description: player not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                required:
                - errors
  "/api/v1/players/{username}/game-history":
    parameters:
    - name: username
      in: path
      description: Player username
      required: true
      schema:
        type: string
    - name: limit
      in: query
      required: false
      description: 'Number of games to return (default: 20, max: 100)'
      schema:
        type: integer
    - name: offset
      in: query
      required: false
      description: 'Offset for pagination (default: 0)'
      schema:
        type: integer
    get:
      summary: List Player Game History
      tags:
      - Player Game History
      description: Retrieves game history for a player, including all completed game
        sessions with stats, high scores, and achievements earned
      responses:
        '200':
          description: successful - no games
          content:
            application/json:
              schema:
                type: object
                properties:
                  player:
                    type: object
                    properties:
                      username:
                        type: string
                        description: Player username
                      total_games:
                        type: integer
                        description: Total number of completed games
                    required:
                    - username
                    - total_games
                  game_history:
                    type: array
                    description: List of game sessions ordered by end date (most recent
                      first)
                    items:
                      type: object
                      properties:
                        session_id:
                          type: string
                          description: Unique session identifier
                        final_score:
                          type: integer
                          description: Final score achieved
                        seed:
                          type: integer
                          description: Random seed used for game generation
                        started_at:
                          type: string
                          format: date-time
                          description: Game start timestamp
                        ended_at:
                          type: string
                          format: date-time
                          description: Game end timestamp
                        game_duration:
                          type: number
                          format: float
                          description: Game duration in seconds
                          nullable: true
                        stats:
                          type: object
                          properties:
                            lilies_collected:
                              type: integer
                              description: Number of lilies collected
                            obstacles_avoided:
                              type: integer
                              description: Number of obstacles avoided
                            hearts_collected:
                              type: integer
                              description: Number of hearts collected
                            max_speed_reached:
                              type: number
                              format: float
                              description: Maximum speed reached
                          required:
                          - lilies_collected
                          - obstacles_avoided
                          - hearts_collected
                          - max_speed_reached
                        high_scores:
                          type: array
                          description: High scores associated with this game session
                          items:
                            type: object
                            properties:
                              id:
                                type: integer
                                description: High score record ID
                              score:
                                type: integer
                                description: Score value
                              player_name:
                                type: string
                                description: Player name at time of score
                              created_at:
                                type: string
                                format: date-time
                                description: When the score was recorded
                            required:
                            - id
                            - score
                            - player_name
                            - created_at
                        achievements_earned:
                          type: integer
                          description: Number of achievements earned during this game
                      required:
                      - session_id
                      - final_score
                      - seed
                      - started_at
                      - ended_at
                      - game_duration
                      - stats
                      - high_scores
                      - achievements_earned
                  pagination:
                    type: object
                    properties:
                      limit:
                        type: integer
                        description: Number of results per page
                      offset:
                        type: integer
                        description: Current offset
                      total:
                        type: integer
                        description: Total number of completed games
                      returned:
                        type: integer
                        description: Number of games returned in this response
                    required:
                    - limit
                    - offset
                    - total
                    - returned
                required:
                - player
                - game_history
                - pagination
        '404':
          description: player not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                required:
                - errors
  "/api/v1/players/profile":
    get:
      summary: Get Player Profile
      tags:
      - Player Profile
      description: Retrieves the authenticated player's profile information
      security:
      - bearer_auth: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  player:
                    type: object
                    properties:
                      id:
                        type: integer
                      email:
                        type: string
                      username:
                        type: string
                      display_name:
                        type: string
                        nullable: true
                      avatar_url:
                        type: string
                        nullable: true
                      avatar:
                        type: object
                        nullable: true
                        properties:
                          url:
                            type: string
                          filename:
                            type: string
                          content_type:
                            type: string
                          byte_size:
                            type: integer
                      profile:
                        type: object
                        properties:
                          bio:
                            type: string
                            nullable: true
                          favorite_otter_fact:
                            type: string
                            nullable: true
                          title:
                            type: string
                            nullable: true
                          profile_banner_url:
                            type: string
                            nullable: true
                          location:
                            type: string
                            nullable: true
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
    patch:
      summary: Update Player Profile
      tags:
      - Player Profile
      description: |
        Updates the authenticated player's profile and player information.

        **Supports two content types:**
        - `application/json` - For updating profile fields without file uploads
        - `multipart/form-data` - Required when uploading avatar images

        **Avatar Upload:**
        To upload an avatar, send a `multipart/form-data` request with the avatar file.
        Supported formats: PNG, JPG, JPEG, GIF, WebP (max 5MB)
      security:
      - bearer_auth: []
      parameters: []
      responses:
        '200':
          description: successful - with avatar upload
          content:
            application/json:
              schema:
                type: object
                properties:
                  player:
                    type: object
                    properties:
                      id:
                        type: integer
                      email:
                        type: string
                      username:
                        type: string
                      display_name:
                        type: string
                      avatar_url:
                        type: string
                        nullable: true
                      avatar:
                        type: object
                        nullable: true
                        properties:
                          url:
                            type: string
                            description: Full URL to access the uploaded avatar
                          filename:
                            type: string
                            description: Original filename of the uploaded avatar
                          content_type:
                            type: string
                            description: MIME type of the avatar image
                          byte_size:
                            type: integer
                            description: File size in bytes
                      profile:
                        type: object
                        properties:
                          bio:
                            type: string
                            nullable: true
                          favorite_otter_fact:
                            type: string
                            nullable: true
                          title:
                            type: string
                            nullable: true
                          profile_banner_url:
                            type: string
                            nullable: true
                          location:
                            type: string
                            nullable: true
                  message:
                    type: string
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
        '422':
          description: unprocessable entity
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                  details:
                    type: object
                    additionalProperties: true
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                player:
                  type: object
                  properties:
                    display_name:
                      type: string
                      description: Player display name
                    username:
                      type: string
                      description: Player username (3-50 characters)
                    email:
                      type: string
                      description: Player email address
                    avatar_url:
                      type: string
                      description: URL to player avatar image
                    avatar:
                      type: string
                      format: binary
                      description: Avatar image file (PNG, JPG, JPEG, GIF, or WebP,
                        max 5MB). Use multipart/form-data when uploading.
                    profile:
                      type: object
                      properties:
                        bio:
                          type: string
                          description: Player bio (max 500 characters)
                        favorite_otter_fact:
                          type: string
                          description: Player's favorite otter fact (max 500 characters)
                        title:
                          type: string
                          description: Player title (max 100 characters)
                        profile_banner_url:
                          type: string
                          description: URL to profile banner image
                        location:
                          type: string
                          description: Player location (max 100 characters)
          multipart/form-data:
            schema:
              type: object
              properties:
                player:
                  type: object
                  properties:
                    display_name:
                      type: string
                      description: Player display name
                    username:
                      type: string
                      description: Player username (3-50 characters)
                    email:
                      type: string
                      description: Player email address
                    avatar_url:
                      type: string
                      description: URL to player avatar image
                    avatar:
                      type: string
                      format: binary
                      description: Avatar image file (PNG, JPG, JPEG, GIF, or WebP,
                        max 5MB). Use multipart/form-data when uploading.
                    profile:
                      type: object
                      properties:
                        bio:
                          type: string
                          description: Player bio (max 500 characters)
                        favorite_otter_fact:
                          type: string
                          description: Player's favorite otter fact (max 500 characters)
                        title:
                          type: string
                          description: Player title (max 100 characters)
                        profile_banner_url:
                          type: string
                          description: URL to profile banner image
                        location:
                          type: string
                          description: Player location (max 100 characters)
  "/api/v1/players/stats":
    get:
      summary: Get Player Stats
      tags:
      - Player Stats
      description: Retrieves the authenticated player's game statistics
      security:
      - bearer_auth: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  player_stats:
                    type: object
                    properties:
                      total_score:
                        type: integer
                        description: Total cumulative score across all games
                      games_played:
                        type: integer
                        description: Total number of games played
                      personal_best:
                        type: integer
                        description: Highest score in a single game
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
servers:
- url: http://localhost:3000
  description: Development server
components:
  securitySchemes:
    bearer_auth:
      type: http
      scheme: bearer
      bearerFormat: JWT
